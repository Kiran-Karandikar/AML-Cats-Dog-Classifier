<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Phase 1</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="data-description--analysis" class="cell markdown" id="fotTwx6uKqIv">
<h3>Data Description &amp; Analysis</h3>
<p>###Cats vs Dogs Detector (CaDoD)</p>
<p><strong>Traning Data</strong> - This contains about images of cats and dogs in jpg format. The images are of various resolution and are RGB scale.</p>
<p><strong>Test Data</strong> - Test data contains images of cats and dogs.</p>
<p>####Data preprocessing</p>
<ul>
<li>The data has to be rescaled to a specific aspect ratio.</li>
<li>Shuffling the train set can be benificial option.</li>
<li>Rescaled training data is saved for easy load in the future.</li>
</ul>
<p>The image archive <code>cadod.tar.gz</code> is a subset <a href="https://storage.googleapis.com/openimages/web/download.html">Open Images V6</a>. It contains a total of 12,966 images of dogs and cats.</p>
<p>Image bounding boxes are stored in the csv file <code>cadod.csv</code>. The following describes whats contained inside the csv.</p>
<ul>
<li>ImageID: the image this box lives in.</li>
<li>Source: indicates how the box was made:
<ul>
<li>xclick are manually drawn boxes using the method presented in [1], were the annotators click on the four extreme points of the object. In V6 we release the actual 4 extreme points for all xclick boxes in train (13M), see below.</li>
<li>activemil are boxes produced using an enhanced version of the method [2]. These are human verified to be accurate at IoU&gt;0.7.</li>
</ul></li>
<li>LabelName: the MID of the object class this box belongs to.</li>
<li>Confidence: a dummy value, always 1.</li>
<li>XMin, XMax, YMin, YMax: coordinates of the box, in normalized image coordinates. XMin is in [0,1], where 0 is the leftmost pixel, and 1 is the rightmost pixel in the image. Y coordinates go from the top pixel (0) to the bottom pixel (1).</li>
<li>XClick1X, XClick2X, XClick3X, XClick4X, XClick1Y, XClick2Y, XClick3Y, XClick4Y: normalized image coordinates (as XMin, etc.) of the four extreme points of the object that produced the box using [1] in the case of xclick boxes. Dummy values of -1 in the case of activemil boxes.</li>
</ul>
<p>The attributes have the following definitions:</p>
<ul>
<li>IsOccluded: Indicates that the object is occluded by another object in the image.</li>
<li>IsTruncated: Indicates that the object extends beyond the boundary of the image.</li>
<li>IsGroupOf: Indicates that the box spans a group of objects (e.g., a bed of flowers or a crowd of people). We asked annotators to use this tag for cases with more than 5 instances which are heavily occluding each other and are physically touching.</li>
<li>IsDepiction: Indicates that the object is a depiction (e.g., a cartoon or drawing of the object, not a real physical instance).</li>
<li>IsInside: Indicates a picture taken from the inside of the object (e.g., a car interior or inside of a building). For each of them, value 1 indicates present, 0 not present, and -1 unknown.</li>
</ul>
</section>
<div class="cell code" data-execution_count="19" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="g51Nn2hiKqIv" data-outputId="bc97d129-edc6-4063-c545-182f82db7342">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.image <span class="im">as</span> mpimg</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.exceptions <span class="im">import</span> ConvergenceWarning</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> SGDClassifier, SGDRegressor</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, mean_squared_error, roc_auc_score</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tarfile</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.notebook <span class="im">import</span> tqdm</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive,files</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">&#39;/content/gdrive&#39;</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Google collab dir: Account: kikarand@iu.edu</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>DATA_DIR<span class="op">=</span><span class="st">&quot;gdrive/MyDrive/data/&quot;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>extract_path <span class="op">=</span> <span class="st">&#39;images/&#39;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>image_file_name <span class="op">=</span> <span class="st">&#39;cadod.tar.gz&#39;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>bounding_box_file_name <span class="op">=</span> <span class="st">&#39;cadod.csv&#39;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>image_path <span class="op">=</span> os.path.join(DATA_DIR, image_file_name)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>bounding_box_path <span class="op">=</span> os.path.join(DATA_DIR, bounding_box_file_name)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Drive already mounted at /content/gdrive; to attempt to forcibly remount, call drive.mount(&quot;/content/gdrive&quot;, force_remount=True).
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="49" id="RkCP3OVoblVB">
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>extract_path <span class="op">=</span> <span class="st">&#39;images/&#39;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>image_file_name <span class="op">=</span> <span class="st">&#39;cadod.tar.gz&#39;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>bounding_box_file_name <span class="op">=</span> <span class="st">&#39;cadod.csv&#39;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>image_path <span class="op">=</span> os.path.join(DATA_DIR, image_file_name)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>bounding_box_path <span class="op">=</span> os.path.join(DATA_DIR, bounding_box_file_name)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>resize_path <span class="op">=</span> os.path.join(extract_path, <span class="st">&quot;resized&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" id="ytYSSmuqa8Vw">
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mkdir <span class="op">-</span>p $resize_path</span></code></pre></div>
</div>
<section id="import-data" class="cell markdown" id="xzBxhYtlKqIv">
<h1>Import Data</h1>
</section>
<section id="unarchive-data" class="cell markdown" id="2nYG7CZAKqIv">
<h3>Unarchive data</h3>
</section>
<div class="cell code" data-execution_count="2" id="i8Wiyjp_KqIv">
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_tar(<span class="bu">file</span>, path):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    function to extract tar.gz files to specified location</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">        file (str): path where the file is located</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">        path (str): path where you want to extract</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> tarfile.<span class="bu">open</span>(<span class="bu">file</span>) <span class="im">as</span> tar:</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        files_extracted <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> member <span class="kw">in</span> tqdm(tar.getmembers()):</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> os.path.isfile(path <span class="op">+</span> member.name[<span class="dv">1</span>:]):</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                tar.extract(member, path)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                files_extracted <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        tar.close()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> files_extracted <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;Files already exist&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="18" data-colab="{&quot;height&quot;:49,&quot;referenced_widgets&quot;:[&quot;ce04ff6c1c334435b00b62936f6c0ebc&quot;,&quot;8ea3aa2d91144aedb9fc7806799966b3&quot;,&quot;ad7cbfdd0f8b49a6b71f28855a30c5bb&quot;,&quot;b416df15dbf2411c8de1d1defd380bba&quot;,&quot;0e68d43d304f417998cf46a7ccbf80c3&quot;,&quot;544166068a84424f909ad509e7cf1bd2&quot;,&quot;8793d32453bb471da72f10ed94900cb2&quot;,&quot;c559ef96393141e1b191b4db9b85c6ca&quot;,&quot;91e6c2c1ae0f4cc8a1009d3691b87b1f&quot;,&quot;dae833c9b84444909da539c18533f19d&quot;,&quot;6376d06d393c4041b6bcc65aadc22d2f&quot;],&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="GZu1vXurKqIv" data-outputId="f9ab5340-79e9-440b-ce7f-781d094f8bac">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>extract_tar(image_path, extract_path)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">,</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;ce04ff6c1c334435b00b62936f6c0ebc&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<section id="load-bounding-box-meta-data" class="cell markdown" id="5qlEn0eCKqIw">
<h3>Load bounding box meta data</h3>
</section>
<div class="cell code" data-execution_count="20" id="ymxqFlviKqIw">
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(bounding_box_path)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="21" data-colab="{&quot;height&quot;:299,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="lTpXPcJ5KqIw" data-outputId="40c05323-d507-4961-f5fe-4cef4286d055">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="21">

  <div id="df-a4198400-24df-4045-9ef9-6d6db1f927b8">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ImageID</th>
      <th>Source</th>
      <th>LabelName</th>
      <th>Confidence</th>
      <th>XMin</th>
      <th>XMax</th>
      <th>YMin</th>
      <th>YMax</th>
      <th>IsOccluded</th>
      <th>IsTruncated</th>
      <th>...</th>
      <th>IsDepiction</th>
      <th>IsInside</th>
      <th>XClick1X</th>
      <th>XClick2X</th>
      <th>XClick3X</th>
      <th>XClick4X</th>
      <th>XClick1Y</th>
      <th>XClick2Y</th>
      <th>XClick3Y</th>
      <th>XClick4Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0000b9fcba019d36</td>
      <td>xclick</td>
      <td>/m/0bt9lr</td>
      <td>1</td>
      <td>0.165000</td>
      <td>0.903750</td>
      <td>0.268333</td>
      <td>0.998333</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.636250</td>
      <td>0.903750</td>
      <td>0.748750</td>
      <td>0.165000</td>
      <td>0.268333</td>
      <td>0.506667</td>
      <td>0.998333</td>
      <td>0.661667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0000cb13febe0138</td>
      <td>xclick</td>
      <td>/m/0bt9lr</td>
      <td>1</td>
      <td>0.000000</td>
      <td>0.651875</td>
      <td>0.000000</td>
      <td>0.999062</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.312500</td>
      <td>0.000000</td>
      <td>0.317500</td>
      <td>0.651875</td>
      <td>0.000000</td>
      <td>0.410882</td>
      <td>0.999062</td>
      <td>0.999062</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0005a9520eb22c19</td>
      <td>xclick</td>
      <td>/m/0bt9lr</td>
      <td>1</td>
      <td>0.094167</td>
      <td>0.611667</td>
      <td>0.055626</td>
      <td>0.998736</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.487500</td>
      <td>0.611667</td>
      <td>0.243333</td>
      <td>0.094167</td>
      <td>0.055626</td>
      <td>0.226296</td>
      <td>0.998736</td>
      <td>0.305942</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0006303f02219b07</td>
      <td>xclick</td>
      <td>/m/0bt9lr</td>
      <td>1</td>
      <td>0.000000</td>
      <td>0.999219</td>
      <td>0.000000</td>
      <td>0.998824</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.508594</td>
      <td>0.999219</td>
      <td>0.000000</td>
      <td>0.478906</td>
      <td>0.000000</td>
      <td>0.375294</td>
      <td>0.720000</td>
      <td>0.998824</td>
    </tr>
    <tr>
      <th>4</th>
      <td>00064d23bf997652</td>
      <td>xclick</td>
      <td>/m/0bt9lr</td>
      <td>1</td>
      <td>0.240938</td>
      <td>0.906183</td>
      <td>0.000000</td>
      <td>0.694286</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0.678038</td>
      <td>0.906183</td>
      <td>0.240938</td>
      <td>0.522388</td>
      <td>0.000000</td>
      <td>0.370000</td>
      <td>0.424286</td>
      <td>0.694286</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-a4198400-24df-4045-9ef9-6d6db1f927b8')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-a4198400-24df-4045-9ef9-6d6db1f927b8 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-a4198400-24df-4045-9ef9-6d6db1f927b8');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>

</div>
</div>
<section id="exploratory-data-analysis" class="cell markdown" id="wXKyhM8UKqIw">
<h1>Exploratory Data Analysis</h1>
</section>
<section id="statistics" class="cell markdown" id="J-xnieyzKqIw">
<h2>Statistics</h2>
</section>
<div class="cell code" data-execution_count="22" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="KwJIA9VzKqIw" data-outputId="66f2b4d3-e24d-4214-d391-1458606c4e42">
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;There are a total of </span><span class="sc">{</span><span class="bu">len</span>(glob.glob1(path, <span class="st">&#39;*.jpg&#39;</span>))<span class="sc">}</span><span class="ss"> images&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>There are a total of 12966 images
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="23" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="9qkXCriaKqIw" data-outputId="88571c9e-d865-4eac-9b7d-c9dd123dfdd4">
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;The total size is </span><span class="sc">{os.</span>path<span class="sc">.</span>getsize(path)<span class="op">/</span><span class="dv">1000</span><span class="sc">}</span><span class="ss"> MB&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>The total size is 1077.248 MB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="24" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="hYun4h7BKqIw" data-outputId="73333636-252e-4c2b-b64d-af8dec70b340">
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="24">
<pre><code>(12966, 21)</code></pre>
</div>
</div>
<div class="cell markdown" id="qFTDI0VDKqIw">
<p>Replace <code>LabelName</code> with human readable labels</p>
</div>
<div class="cell code" data-execution_count="25" id="Y6h99f0IKqIw">
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df.LabelName.replace({<span class="st">&#39;/m/01yrx&#39;</span>:<span class="st">&#39;cat&#39;</span>, <span class="st">&#39;/m/0bt9lr&#39;</span>:<span class="st">&#39;dog&#39;</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="26" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="gledr531KqIw" data-outputId="9a552b3c-d28f-4dbb-99a3-0d493676db28">
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df.LabelName.value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="26">
<pre><code>dog    6855
cat    6111
Name: LabelName, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="27" data-colab="{&quot;height&quot;:290,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="fqVuuodiKqIw" data-outputId="f8b86083-7b8a-4096-aff8-3d0a19ed21b7">
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df.LabelName.value_counts().plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Image Class Count&#39;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="assets/img_3.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="28" data-colab="{&quot;height&quot;:364,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="3YQ1tYdeKqIw" data-outputId="6595e997-72ae-47e0-fa26-04dcf28e0860">
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="28">

  <div id="df-5d3d9f61-3722-444d-bd13-6f2f09469272">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Confidence</th>
      <th>XMin</th>
      <th>XMax</th>
      <th>YMin</th>
      <th>YMax</th>
      <th>IsOccluded</th>
      <th>IsTruncated</th>
      <th>IsGroupOf</th>
      <th>IsDepiction</th>
      <th>IsInside</th>
      <th>XClick1X</th>
      <th>XClick2X</th>
      <th>XClick3X</th>
      <th>XClick4X</th>
      <th>XClick1Y</th>
      <th>XClick2Y</th>
      <th>XClick3Y</th>
      <th>XClick4Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>12966.0</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
      <td>12966.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.0</td>
      <td>0.099437</td>
      <td>0.901750</td>
      <td>0.088877</td>
      <td>0.945022</td>
      <td>0.464754</td>
      <td>0.738470</td>
      <td>0.013651</td>
      <td>0.045427</td>
      <td>0.001157</td>
      <td>0.390356</td>
      <td>0.424582</td>
      <td>0.494143</td>
      <td>0.506689</td>
      <td>0.275434</td>
      <td>0.447448</td>
      <td>0.641749</td>
      <td>0.582910</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.0</td>
      <td>0.113023</td>
      <td>0.111468</td>
      <td>0.097345</td>
      <td>0.081500</td>
      <td>0.499239</td>
      <td>0.440011</td>
      <td>0.118019</td>
      <td>0.209354</td>
      <td>0.040229</td>
      <td>0.358313</td>
      <td>0.441751</td>
      <td>0.405033</td>
      <td>0.462281</td>
      <td>0.415511</td>
      <td>0.401580</td>
      <td>0.448054</td>
      <td>0.403454</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.408125</td>
      <td>0.000000</td>
      <td>0.451389</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.830625</td>
      <td>0.000000</td>
      <td>0.910000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.221292</td>
      <td>0.096875</td>
      <td>0.285071</td>
      <td>0.130000</td>
      <td>0.024323</td>
      <td>0.218333</td>
      <td>0.405816</td>
      <td>0.400000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.0</td>
      <td>0.061250</td>
      <td>0.941682</td>
      <td>0.059695</td>
      <td>0.996875</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.435625</td>
      <td>0.415625</td>
      <td>0.531919</td>
      <td>0.623437</td>
      <td>0.146319</td>
      <td>0.480838</td>
      <td>0.825000</td>
      <td>0.646667</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.0</td>
      <td>0.167500</td>
      <td>0.998889</td>
      <td>0.144853</td>
      <td>0.999062</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.609995</td>
      <td>0.820000</td>
      <td>0.787500</td>
      <td>0.917529</td>
      <td>0.561323</td>
      <td>0.729069</td>
      <td>0.998042</td>
      <td>0.882500</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.0</td>
      <td>0.592500</td>
      <td>1.000000</td>
      <td>0.587088</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.999375</td>
      <td>0.999375</td>
      <td>1.000000</td>
      <td>0.999375</td>
      <td>0.999375</td>
      <td>0.999375</td>
      <td>1.000000</td>
      <td>0.999375</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-5d3d9f61-3722-444d-bd13-6f2f09469272')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-5d3d9f61-3722-444d-bd13-6f2f09469272 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-5d3d9f61-3722-444d-bd13-6f2f09469272');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>

</div>
</div>
<section id="sample-of-images" class="cell markdown" id="lZQIgpr4KqIx">
<h2>Sample of Images</h2>
</section>
<div class="cell code" data-execution_count="29" data-colab="{&quot;height&quot;:697,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="EfuFMCZxKqIx" data-outputId="23936e12-60c3-40f6-a3a9-f73b3593d46a">
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot random 6 images</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">3</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> ax.flatten()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,j <span class="kw">in</span> <span class="bu">enumerate</span>(np.random.choice(df.shape[<span class="dv">0</span>], size<span class="op">=</span><span class="dv">6</span>, replace<span class="op">=</span><span class="va">False</span>)):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> mpimg.imread(path <span class="op">+</span> df.ImageID.values[j] <span class="op">+</span> <span class="st">&#39;.jpg&#39;</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> img.shape[:<span class="dv">2</span>]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> df.iloc[j,<span class="dv">4</span>:<span class="dv">8</span>]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    ax[i].imshow(img)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(df.LabelName[j])</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    ax[i].add_patch(plt.Rectangle((coords[<span class="dv">0</span>]<span class="op">*</span>w, coords[<span class="dv">2</span>]<span class="op">*</span>h), </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                                  coords[<span class="dv">1</span>]<span class="op">*</span>w<span class="op">-</span>coords[<span class="dv">0</span>]<span class="op">*</span>w, coords[<span class="dv">3</span>]<span class="op">*</span>h<span class="op">-</span>coords[<span class="dv">2</span>]<span class="op">*</span>h, </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                                  edgecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>, facecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>))</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="assets/img_9.png" /></p>
</div>
</div>
<section id="image-shapes-and-sizes" class="cell markdown" id="U2h2mz57KqIx">
<h2>Image shapes and sizes</h2>
</section>
<div class="cell markdown" id="BHMe4upKKqIx">
<p>Go through all images and record the shape of the image in pixels and the memory size</p>
</div>
<div class="cell code" data-execution_count="30" data-colab="{&quot;height&quot;:49,&quot;referenced_widgets&quot;:[&quot;50c6f45470994f83a9dd8254cdf9593b&quot;,&quot;747521276a25498091fff4f521e1f8a6&quot;,&quot;57c9a0538a594abf96a6a8fb886eb4f1&quot;,&quot;16d59d9b4365455496e79f853a9cdbad&quot;,&quot;5c64abd2cb894a63a158ab14e1891365&quot;,&quot;b7de6ef360774909852166e16f86ce44&quot;,&quot;8df4db48b98b49149dad0e85abe06bc8&quot;,&quot;77de244b5f284455975d5e7a22c0b9e7&quot;,&quot;3b599a19ad41460d9bd24da98f1251a5&quot;,&quot;9db8fc7c5ae2406195dd08e5df45052c&quot;,&quot;d308c837b5e04496bb128020d640cbaa&quot;],&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="UKAAFJO5KqIx" data-outputId="bd33da33-bb91-4a68-8ffa-49eac6dc6c25">
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>img_shape <span class="op">=</span> []</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>img_size <span class="op">=</span> np.zeros((df.shape[<span class="dv">0</span>], <span class="dv">1</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,f <span class="kw">in</span> <span class="bu">enumerate</span>(tqdm(glob.glob1(path, <span class="st">&#39;*.jpg&#39;</span>))):</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">file</span> <span class="op">=</span> path<span class="op">+</span><span class="st">&#39;/&#39;</span><span class="op">+</span>f</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(<span class="bu">file</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    img_shape.append(<span class="ss">f&quot;</span><span class="sc">{</span>img<span class="sc">.</span>size[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>img<span class="sc">.</span>size[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    img_size[i] <span class="op">+=</span> os.path.getsize(<span class="bu">file</span>)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb23"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">,</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;50c6f45470994f83a9dd8254cdf9593b&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="qr2S2dc5KqIx">
<p>Count all the different image shapes</p>
</div>
<div class="cell code" data-execution_count="31" id="IRXhcBpeKqIx">
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>img_shape_count <span class="op">=</span> Counter(img_shape)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="32" id="0ZNoo-KHKqIx">
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dataframe for image shapes</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>img_df <span class="op">=</span> pd.DataFrame(<span class="bu">set</span>(img_shape_count.items()), columns<span class="op">=</span>[<span class="st">&#39;img_shape&#39;</span>,<span class="st">&#39;img_count&#39;</span>])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="33" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="--duAh4QKqIx" data-outputId="ad74528c-e4c1-484e-de97-e10dd2c3118b">
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>img_df.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="33">
<pre><code>(594, 2)</code></pre>
</div>
</div>
<div class="cell markdown" id="u2aW_Og6KqIx">
<p>There are a ton of different image shapes. Let's narrow this down by getting a sum of any image shape that has a cout less than 100 and put that in a category called <code>other</code></p>
</div>
<div class="cell code" data-execution_count="34" id="AY4rMz8BKqIx">
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>img_df <span class="op">=</span> img_df.append({<span class="st">&#39;img_shape&#39;</span>: <span class="st">&#39;other&#39;</span>,<span class="st">&#39;img_count&#39;</span>: img_df[img_df.img_count <span class="op">&lt;</span> <span class="dv">100</span>].img_count.<span class="bu">sum</span>()}, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                       ignore_index<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell markdown" id="c9MrBPnpKqIx">
<p>Drop all image shapes</p>
</div>
<div class="cell code" data-execution_count="35" id="734FWg_-KqIx">
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>img_df <span class="op">=</span> img_df[img_df.img_count <span class="op">&gt;=</span> <span class="dv">100</span>]</span></code></pre></div>
</div>
<div class="cell markdown" id="Ef0krmACKqIx">
<p>Check if the count sum matches the number of images</p>
</div>
<div class="cell code" data-execution_count="36" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="RKmzEAeXKqIx" data-outputId="5508ca67-9219-48ef-dca3-1fb62b6ef182">
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>img_df.img_count.<span class="bu">sum</span>() <span class="op">==</span> df.shape[<span class="dv">0</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="36">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell markdown" id="zmjcmC_dKqIx">
<p>Plot</p>
<h2 id="todo-plot-aspect-ratio">TODO plot aspect ratio</h2>
</div>
<div class="cell code" data-execution_count="37" data-colab="{&quot;height&quot;:499,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="Y2IlLcUlKqIx" data-outputId="93696a92-32bc-4c8b-8e8b-5a9b7bad864d">
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>img_df.sort_values(<span class="st">&#39;img_count&#39;</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>img_df.plot(x<span class="op">=</span><span class="st">&#39;img_shape&#39;</span>, y<span class="op">=</span><span class="st">&#39;img_count&#39;</span>, kind<span class="op">=</span><span class="st">&#39;barh&#39;</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>), legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Image Shape Counts&#39;</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="assets/img_8.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="38" id="7mUlTd5sKqIx">
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to megabytes</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>img_size <span class="op">=</span> img_size <span class="op">/</span> <span class="dv">1000</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="39" data-colab="{&quot;height&quot;:370,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="T7zSxLyVKqIx" data-outputId="4fd484fc-04c4-4499-feba-be346aa24e9d">
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">&#39;Image Size Distribution&#39;</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(img_size, bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">&#39;Histogram&#39;</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">&#39;Image Size (MB)&#39;</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].boxplot(img_size, vert<span class="op">=</span><span class="va">False</span>, widths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">&#39;Boxplot&#39;</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">&#39;Image Size (MB)&#39;</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">&#39;Images&#39;</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="assets/img_5.png" /></p>
</div>
</div>
<section id="preprocess" class="cell markdown" id="PTTZ4sCoKqIx">
<h1>Preprocess</h1>
</section>
<section id="rescale-the-images" class="cell markdown" id="oFsCU74pKqIx">
<h2>Rescale the images</h2>
</section>
<div class="cell code" data-execution_count="51" id="VsBGTytfKqIx">
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> glob.glob(<span class="ss">f&#39;</span><span class="sc">{</span>resize_path<span class="sc">}</span><span class="ss">/*&#39;</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> files:</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    os.remove(f)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="52" data-colab="{&quot;height&quot;:84,&quot;referenced_widgets&quot;:[&quot;ac871daf03b04ce2929b234f5cb78b12&quot;,&quot;6466104689f54c91858c35a2969aae65&quot;,&quot;01942f752d48437f9057a3919ac36578&quot;,&quot;7a5267db657e4d09bfd28d11c941e08e&quot;,&quot;77c166c77966450c81e6891e1af0d4cc&quot;,&quot;efda3bc6e6494b24966db2bc791307ee&quot;,&quot;4b52a79790cd4de3a3ab4a53e9c406e8&quot;,&quot;f698276ebc2f462ca090ce3878f1ca67&quot;,&quot;0d88a10a92d14be2874600012163054b&quot;,&quot;29b461f5f5dd49bfb51456190a71cabb&quot;,&quot;a60e430c31fd43aa825e190c258a858e&quot;],&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="IaOsqiCvKqIx" data-outputId="961772c0-d3f1-422e-b0ed-b7ba545b873b">
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># resize image and save, convert to numpy</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>img_arr <span class="op">=</span> np.zeros((df.shape[<span class="dv">0</span>],<span class="dv">32</span><span class="op">*</span><span class="dv">32</span><span class="op">*</span><span class="dv">3</span>)) <span class="co"># initialize np.array</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, f <span class="kw">in</span> <span class="bu">enumerate</span>(tqdm(df.ImageID)):</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(extract_path<span class="op">+</span>f<span class="op">+</span><span class="st">&#39;.jpg&#39;</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    img_resized <span class="op">=</span> img.resize((<span class="dv">32</span>,<span class="dv">32</span>))</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    img_resized.save(os.path.join(resize_path,<span class="ss">f&quot;</span><span class="sc">{f}</span><span class="ss">.jpg&quot;</span>), <span class="st">&quot;JPEG&quot;</span>, optimize<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    img_arr[i] <span class="op">=</span> np.asarray(img_resized, dtype<span class="op">=</span>np.uint8).flatten()</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb37"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">,</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;ac871daf03b04ce2929b234f5cb78b12&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>CPU times: user 1min 4s, sys: 2.21 s, total: 1min 6s
Wall time: 1min 7s
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="53" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="JyzRccZbSguN" data-outputId="b5e9f51d-c1f0-45a8-e3c0-b665a771569c">
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(img_arr[<span class="dv">0</span>]))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>3072
</code></pre>
</div>
</div>
<div class="cell markdown" id="btnSYzvnKqIx">
<p>Plot the resized and filtered images</p>
</div>
<div class="cell code" data-execution_count="55" data-colab="{&quot;height&quot;:730,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="XwmJ1ItWKqIx" data-outputId="b83e64c8-f6c7-400f-92d6-310990ce609f">
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot random 6 images</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">3</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> ax.flatten()</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,j <span class="kw">in</span> <span class="bu">enumerate</span>(np.random.choice(df.shape[<span class="dv">0</span>], size<span class="op">=</span><span class="dv">6</span>, replace<span class="op">=</span><span class="va">False</span>)):</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> mpimg.imread(<span class="ss">f&quot;</span><span class="sc">{</span>resize_path<span class="sc">}</span><span class="ss">/&quot;</span><span class="op">+</span>df.ImageID.values[j]<span class="op">+</span><span class="st">&#39;.jpg&#39;</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> img.shape[:<span class="dv">2</span>]</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> df.iloc[j,<span class="dv">4</span>:<span class="dv">8</span>]</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    ax[i].imshow(img)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(df.iloc[j,<span class="dv">2</span>])</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    ax[i].add_patch(plt.Rectangle((coords[<span class="dv">0</span>]<span class="op">*</span>w, coords[<span class="dv">2</span>]<span class="op">*</span>h), </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                                  coords[<span class="dv">1</span>]<span class="op">*</span>w<span class="op">-</span>coords[<span class="dv">0</span>]<span class="op">*</span>w, coords[<span class="dv">3</span>]<span class="op">*</span>h<span class="op">-</span>coords[<span class="dv">2</span>]<span class="op">*</span>h, </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                                  edgecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>, facecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>))</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="assets/img_7.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="56" id="15Ty8q3AKqIx">
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># encode labels</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Label&#39;</span>] <span class="op">=</span> (df.LabelName <span class="op">==</span> <span class="st">&#39;dog&#39;</span>).astype(np.uint8)</span></code></pre></div>
</div>
<section id="comparing-images-before-and-after" class="cell markdown" id="lKuhwpcsSguO">
<h3>Comparing Images Before and After</h3>
</section>
<div class="cell code" data-execution_count="57" data-colab="{&quot;height&quot;:719,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="rocSqL2TSguO" data-outputId="8ebf6c28-b730-4aa4-8882-9cfb3c71264d">
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot first 6 images</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">3</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> ax.flatten()</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,j <span class="kw">in</span> <span class="bu">enumerate</span>(df.index[<span class="dv">5584</span>:<span class="dv">5590</span>].to_numpy()):</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> mpimg.imread(extract_path <span class="op">+</span> df.ImageID.values[j] <span class="op">+</span> <span class="st">&#39;.jpg&#39;</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> img.shape[:<span class="dv">2</span>]</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> df.iloc[j,<span class="dv">4</span>:<span class="dv">8</span>]</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    ax[i].imshow(img)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(df.LabelName[j])</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    ax[i].add_patch(plt.Rectangle((coords[<span class="dv">0</span>]<span class="op">*</span>w, coords[<span class="dv">2</span>]<span class="op">*</span>h), </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>                                  coords[<span class="dv">1</span>]<span class="op">*</span>w<span class="op">-</span>coords[<span class="dv">0</span>]<span class="op">*</span>w, coords[<span class="dv">3</span>]<span class="op">*</span>h<span class="op">-</span>coords[<span class="dv">2</span>]<span class="op">*</span>h, </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>                                  edgecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>, facecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>))</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="assets/img_2.png" /></p>
</div>
</div>
<section id="checkpoint-and-save-data" class="cell markdown" id="H8nKwWglKqIx">
<h2>Checkpoint and Save data</h2>
</section>
<div class="cell code" data-execution_count="58" id="LM_pJn7rKqIx">
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mkdir <span class="op">-</span>p <span class="op">\</span>data</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="59" id="Qfr2fyTaKqIx">
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>np.save(<span class="st">&#39;data/img.npy&#39;</span>, img_arr.astype(np.uint8))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>np.save(<span class="st">&#39;data/y_label.npy&#39;</span>, df.Label.values)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>np.save(<span class="st">&#39;data/y_bbox.npy&#39;</span>, df[[<span class="st">&#39;XMin&#39;</span>, <span class="st">&#39;YMin&#39;</span>, <span class="st">&#39;XMax&#39;</span>, <span class="st">&#39;YMax&#39;</span>]].values.astype(np.float32))</span></code></pre></div>
</div>
<section id="baseline-in-sklearn" class="cell markdown" id="pJiQLlj0KqIx">
<h1>Baseline in SKLearn</h1>
</section>
<section id="load-data" class="cell markdown" id="ItsLzaLvKqIy">
<h2>Load data</h2>
</section>
<div class="cell code" data-execution_count="60" id="QK3aLIQNKqIy">
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.load(<span class="st">&#39;data/img.npy&#39;</span>, allow_pickle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>y_label <span class="op">=</span> np.load(<span class="st">&#39;data/y_label.npy&#39;</span>, allow_pickle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>y_bbox <span class="op">=</span> np.load(<span class="st">&#39;data/y_bbox.npy&#39;</span>, allow_pickle<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="61" id="V4aY5eoyKqIy">
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>idx_to_label <span class="op">=</span> {<span class="dv">1</span>:<span class="st">&#39;dog&#39;</span>, <span class="dv">0</span>:<span class="st">&#39;cat&#39;</span>} <span class="co"># encoder</span></span></code></pre></div>
</div>
<div class="cell markdown" id="IgBJ8W6VKqIy">
<p>Double check that it loaded correctly</p>
</div>
<div class="cell code" data-execution_count="62" data-colab="{&quot;height&quot;:730,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="ODilTJB3KqIy" data-outputId="dac3177b-1ec8-420a-902b-31360f32b135">
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot random 6 images</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">3</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> ax.flatten()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,j <span class="kw">in</span> <span class="bu">enumerate</span>(np.random.choice(X.shape[<span class="dv">0</span>], size<span class="op">=</span><span class="dv">6</span>, replace<span class="op">=</span><span class="va">False</span>)):</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> y_bbox[j] <span class="op">*</span> <span class="dv">32</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    ax[i].imshow(X[j].reshape(<span class="dv">32</span>,<span class="dv">32</span>,<span class="dv">3</span>))</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(idx_to_label[y_label[j]])</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    ax[i].add_patch(plt.Rectangle((coords[<span class="dv">0</span>], coords[<span class="dv">1</span>]), </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>                                  coords[<span class="dv">2</span>]<span class="op">-</span>coords[<span class="dv">0</span>], coords[<span class="dv">3</span>]<span class="op">-</span>coords[<span class="dv">1</span>], </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>                                  edgecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>, facecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="assets/img_4.png" /></p>
</div>
</div>
<section id="classification" class="cell markdown" id="4FJPGN8MKqIy">
<h2>Classification</h2>
</section>
<section id="split-data" class="cell markdown" id="XcCIbe4aKqIy">
<h3>Split data</h3>
<p>Create training and testing sets</p>
</section>
<div class="cell code" data-execution_count="63" id="erJMSqFVKqIy">
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test_label <span class="op">=</span> train_test_split(X, y_label, test_size<span class="op">=</span><span class="fl">0.01</span>, random_state<span class="op">=</span><span class="dv">27</span>)</span></code></pre></div>
</div>
<section id="train" class="cell markdown" id="sTcYcYGpKqIy">
<h3>Train</h3>
<p>I'm choosing <code>SGDClassifier</code> because the data is large and I want to be able to perform stochastic gradient descent and also its ability to early stop. With this many parameters, a model can easily overfit so it's important to try and find the point of where it begins to overfit and stop for optimal results.</p>
</section>
<div class="cell code" data-execution_count="64" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="vL4PEsXzKqIy" data-outputId="b839bf3d-8fef-4912-d3a5-fcafa5eefcc6">
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> SGDClassifier(loss<span class="op">=</span><span class="st">&#39;log&#39;</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">27</span>, learning_rate<span class="op">=</span><span class="st">&#39;adaptive&#39;</span>, eta0<span class="op">=</span><span class="fl">1e-10</span>, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                      early_stopping<span class="op">=</span><span class="va">True</span>, validation_fraction<span class="op">=</span><span class="fl">0.1</span>, n_iter_no_change<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.2 validation </span><span class="al">TODO</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>CPU times: user 1.11 s, sys: 509 ms, total: 1.62 s
Wall time: 1.2 s
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="65" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="bxGIEvbzKqIy" data-outputId="ff9a00e2-5c83-454c-cb48-5e831d78c1a7">
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>model.n_iter_</span></code></pre></div>
<div class="output execute_result" data-execution_count="65">
<pre><code>4</code></pre>
</div>
</div>
<div class="cell markdown" id="7U7C5XMxKqIy">
<p>Did it stop too early? Let's retrain with a few more iterations to see. Note that <code>SGDClassifier</code> has a parameter called <code>validation_fraction</code> which splits a validation set from the training data to determine when it stops.</p>
</div>
<div class="cell code" data-execution_count="66" id="fJkfwivcKqIy">
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>X_train, X_valid, y_train, y_valid <span class="op">=</span> train_test_split(X_train, y_train, test_size<span class="op">=</span><span class="fl">0.1</span>, random_state<span class="op">=</span><span class="dv">27</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="67" data-colab="{&quot;height&quot;:49,&quot;referenced_widgets&quot;:[&quot;eb902c9b6a4448a8bc40b9d797a608db&quot;,&quot;f44b24844975447caa7744994b6ec7e3&quot;,&quot;0a4a7d640fdc4459a6a5cde16ff659af&quot;,&quot;9f12711db82a430cbf98ca74b8e7b184&quot;,&quot;70007ba6040e4c25ad0c95e33c1184a2&quot;,&quot;caceb4b6def5492aa8f3c7ebed7a72ad&quot;,&quot;18f680e078a8493389a5e27cc739ea22&quot;,&quot;d459a612a7474057a6f7798a96a0fa7f&quot;,&quot;b91665f80e1d48d391563a314fec118b&quot;,&quot;4e2b50dc88514133b94e319bdab53e9a&quot;,&quot;01dff4a3241a4aa1b6c4a55a641d5a36&quot;],&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="vgRZscLjKqIy" data-outputId="a91e7e91-202a-4dcd-aa52-284ad4ab25ed">
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> SGDClassifier(loss<span class="op">=</span><span class="st">&#39;log&#39;</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">27</span>, learning_rate<span class="op">=</span><span class="st">&#39;adaptive&#39;</span>, eta0<span class="op">=</span><span class="fl">1e-10</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>train_acc <span class="op">=</span> np.zeros(epochs)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>valid_acc <span class="op">=</span> np.zeros(epochs)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(epochs)):</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    model2.partial_fit(X_train, y_train, np.unique(y_train))</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#log</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    train_acc[i] <span class="op">+=</span> np.<span class="bu">round</span>(accuracy_score(y_train, model2.predict(X_train)),<span class="dv">3</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    valid_acc[i] <span class="op">+=</span> np.<span class="bu">round</span>(accuracy_score(y_valid, model2.predict(X_valid)),<span class="dv">3</span>)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb56"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">,</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;eb902c9b6a4448a8bc40b9d797a608db&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell code" data-execution_count="68" data-colab="{&quot;height&quot;:295,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="kYz1N8lVKqIy" data-outputId="5889862b-b245-4eae-ff31-a82faa30f5f9">
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>plt.plot(train_acc, label<span class="op">=</span><span class="st">&#39;train&#39;</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>plt.plot(valid_acc, label<span class="op">=</span><span class="st">&#39;valid&#39;</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;CaDoD Training&#39;</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Epochs&#39;</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Accuracy&#39;</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="assets/img_6.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="69" id="kSF3hSPCKqIy">
<div class="sourceCode" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> model2</span></code></pre></div>
</div>
<section id="evaluation" class="cell markdown" id="naRFdrZiKqIy">
<h3>Evaluation</h3>
</section>
<div class="cell code" data-execution_count="75" id="LwxNrGjBKqIy">
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>expLog <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">&quot;exp_name&quot;</span>, </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Train Acc&quot;</span>, </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Valid Acc&quot;</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Test  Acc&quot;</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Train MSE&quot;</span>, </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Valid MSE&quot;</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Test  MSE&quot;</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                              ])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="76" id="nYnhJU-ZKqIy">
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>exp_name <span class="op">=</span> <span class="ss">f&quot;Baseline: Linear Model&quot;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>expLog.loc[<span class="dv">0</span>,:<span class="dv">4</span>] <span class="op">=</span> [<span class="ss">f&quot;</span><span class="sc">{</span>exp_name<span class="sc">}</span><span class="ss">&quot;</span>] <span class="op">+</span> <span class="bu">list</span>(np.<span class="bu">round</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>               [accuracy_score(y_train, model.predict(X_train)), </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                accuracy_score(y_valid, model.predict(X_valid)),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                accuracy_score(y_test_label, model.predict(X_test))],<span class="dv">3</span>))</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="77" data-colab="{&quot;height&quot;:81,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="7PHpvx6gKqIy" data-outputId="5219382f-a493-4055-ea02-f5d4c03818ac">
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>expLog</span></code></pre></div>
<div class="output execute_result" data-execution_count="77">

  <div id="df-2a450b7b-fd89-4050-8a6c-c7627e684011">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>exp_name</th>
      <th>Train Acc</th>
      <th>Valid Acc</th>
      <th>Test  Acc</th>
      <th>Train MSE</th>
      <th>Valid MSE</th>
      <th>Test  MSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Baseline: Linear Model</td>
      <td>0.565</td>
      <td>0.557</td>
      <td>0.615</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-2a450b7b-fd89-4050-8a6c-c7627e684011')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-2a450b7b-fd89-4050-8a6c-c7627e684011 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-2a450b7b-fd89-4050-8a6c-c7627e684011');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="78" data-colab="{&quot;height&quot;:445,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="OsxLqjPlKqIy" data-outputId="10869255-a32e-43d9-bea3-dd6e82cf93e0">
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>y_pred_label <span class="op">=</span> model.predict(X_test)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>y_pred_label_proba <span class="op">=</span> model.predict_proba(X_test)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">5</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">6</span>))</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> ax.flatten()</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> X_test[i].reshape(<span class="dv">32</span>,<span class="dv">32</span>,<span class="dv">3</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    ax[i].imshow(img)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="st">&quot;Ground Truth: </span><span class="sc">{0}</span><span class="st"> </span><span class="ch">\n</span><span class="st"> Prediction: </span><span class="sc">{1}</span><span class="st"> | </span><span class="sc">{2:.2f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(idx_to_label[y_test_label[i]],</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>                                                                   idx_to_label[y_pred_label[i]],</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>                                                                   y_pred_label_proba[i][y_pred_label[i]]),</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span>(<span class="st">&quot;green&quot;</span> <span class="cf">if</span> y_pred_label[i]<span class="op">==</span>y_test_label[i] <span class="cf">else</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="assets/img_1.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="79" id="Qp3JBXHlSgz3">
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># imports</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> time <span class="im">import</span> time</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, TransformerMixin</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> ShuffleSplit</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> GaussianNB</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> SGDClassifier</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span></code></pre></div>
</div>
<section id="regression" class="cell markdown" id="LDM0aGUnKqIy">
<h2>Regression</h2>
</section>
<section id="split-data" class="cell markdown" id="13nnDLu3KqIy">
<h3>Split data</h3>
</section>
<div class="cell code" data-execution_count="80" id="G-ZrNT6ySgz4">
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> []</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i1 <span class="kw">in</span> img_arr:</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    d1.append(i1)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>temp_image_data<span class="op">=</span>[]</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(df)):</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    temp_image_data.append(pd.Series(data <span class="op">=</span> d1).iloc[i])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="81" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="xJ3CNMYMSgz4" data-outputId="9c2bfcba-fbab-4b37-cba0-066df9c0c426">
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(temp_image_data)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(img_arr[<span class="dv">0</span>])</span></code></pre></div>
<div class="output execute_result" data-execution_count="81">
<pre><code>3072</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="82" id="nHMDsQyuSgz5">
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(np.array(temp_image_data), y_bbox, test_size<span class="op">=</span><span class="fl">0.01</span>, random_state<span class="op">=</span><span class="dv">27</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>X_train, X_valid, y_train, y_valid <span class="op">=</span> train_test_split(X_train, y_train, test_size<span class="op">=</span><span class="fl">0.1</span>, random_state<span class="op">=</span><span class="dv">27</span>)</span></code></pre></div>
</div>
<section id="train" class="cell markdown" id="B0fCNF2UKqIy">
<h3>Train</h3>
</section>
<div class="cell code" data-execution_count="83" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="a6t0-pvIKqIy" data-outputId="808d98ff-a947-4189-ec78-b8ee12b259cc">
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> closed loop solution, could use Lasso Ridge</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearRegression() <span class="co">#fill in </span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># might take a few minutes to train</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#CPU times: user 1h 26min 40s, sys: 5min 53s, total: 1h 32min 34s</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Wall time: 17min 24s</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>CPU times: user 41.3 s, sys: 3.98 s, total: 45.3 s
Wall time: 28.4 s
</code></pre>
</div>
</div>
<section id="baseline-linear-regression-with-lasso-and-ridge" class="cell markdown" id="ZhWF6ybjSg0C">
<h3>Baseline Linear regression with lasso and ridge</h3>
</section>
<section id="evaluation" class="cell markdown" id="aHqKrEDWKqIy">
<h3>Evaluation</h3>
</section>
<div class="cell code" data-execution_count="84" data-colab="{&quot;height&quot;:81,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="kfUPQ0B_KqIy" data-outputId="b19b7d80-8b5c-4827-beac-09ef05c01dfb">
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>expLog.iloc[<span class="dv">0</span>,<span class="dv">4</span>:] <span class="op">=</span> <span class="bu">list</span>(np.<span class="bu">round</span>([mean_squared_error(y_train, model.predict(X_train)), </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>          mean_squared_error(y_valid, model.predict(X_valid)), </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>          mean_squared_error(y_test, model.predict(X_test))],<span class="dv">3</span>))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>expLog</span></code></pre></div>
<div class="output execute_result" data-execution_count="84">

  <div id="df-32e01219-9332-4ec6-ab4c-92266a3a5435">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>exp_name</th>
      <th>Train Acc</th>
      <th>Valid Acc</th>
      <th>Test  Acc</th>
      <th>Train MSE</th>
      <th>Valid MSE</th>
      <th>Test  MSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Baseline: Linear Model</td>
      <td>0.565</td>
      <td>0.557</td>
      <td>0.615</td>
      <td>0.007</td>
      <td>0.015</td>
      <td>0.015</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-32e01219-9332-4ec6-ab4c-92266a3a5435')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-32e01219-9332-4ec6-ab4c-92266a3a5435 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-32e01219-9332-4ec6-ab4c-92266a3a5435');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="85" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="SeTMZoKESg0D" data-outputId="4948a644-5993-4f17-84d8-cd9f0eb2e266">
<div class="sourceCode" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The below code is refered from Hw5</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Ridge</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Lasso</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>estimators <span class="op">=</span> [(<span class="st">&#39;ridge&#39;</span>, Ridge()),</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>              (<span class="st">&#39;lasso&#39;</span>, Lasso())]</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>best_score <span class="op">=</span> []</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>best_param <span class="op">=</span> []</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> estimator <span class="kw">in</span> estimators:</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {estimator[<span class="dv">0</span>]<span class="op">+</span><span class="st">&#39;__alpha&#39;</span>:[<span class="fl">.01</span>, <span class="fl">.05</span>, <span class="fl">.1</span>, <span class="fl">.5</span>, <span class="dv">1</span>, <span class="dv">5</span>]}</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set up the pipeline using the standard scaler and estimator</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and grid search with pipeline, params, </span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and correct scoring parameter (scoring parameter has to be a utility- where bigger is better </span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># such as neg_mean_squared_error, explained_variance etc. )</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for more information see the following - </span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     https://scikit-learn.org/stable/modules/model_evaluation.html#scoring-parameter</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Please use neg_mean_squared_error here.</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#==================================================#</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#               Your code starts here              #</span></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#==================================================#</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co"> - change above to</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>    pipe <span class="op">=</span> Pipeline([(<span class="st">&#39;scalar&#39;</span>, StandardScaler()), estimator])</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>    gs <span class="op">=</span> GridSearchCV(pipe, params, scoring<span class="op">=</span><span class="st">&#39;neg_mean_squared_error&#39;</span>,cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#==================================================#</span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#               Your code ends here                #</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#==================================================#</span></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>    gs.fit(X_train, y_train)</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>    best_score.append(gs.best_score_)</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>    best_param.append(gs.best_params_)</span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>best_idx <span class="op">=</span> np.argmax(best_score)</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Best model is:&#39;</span>, estimators[best_idx][<span class="dv">0</span>], <span class="st">&#39;with parameter&#39;</span>, best_param[best_idx])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Best model is: lasso with parameter {&#39;lasso__alpha&#39;: 0.01}
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="86" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="j8v9z30JSg0E" data-outputId="d35ecebf-50ab-4444-e6ea-e935be144f26">
<div class="sourceCode" id="cb73"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(best_param[best_idx].values())[<span class="dv">0</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="86">
<pre><code>0.01</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="87" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="ovkYVGfGSg0E" data-outputId="cc6f041a-cd13-4dbe-87d3-539b318874b2">
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#estimator = estimators[best_idx][0], list(best_param[best_idx].values())[0])</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>estimator <span class="op">=</span> [Ridge, Lasso][best_idx]</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>param <span class="op">=</span> <span class="bu">list</span>(gs.best_params_.values())[<span class="dv">0</span>]</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (param)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the pipeline using the best estimator</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline([(<span class="st">&#39;scalar&#39;</span>, StandardScaler()), (<span class="st">&#39;estimator&#39;</span>, estimator(alpha<span class="op">=</span>param))])</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>pipe.fit(X_train, y_train)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>0.01
</code></pre>
</div>
<div class="output execute_result" data-execution_count="87">
<pre><code>Pipeline(steps=[(&#39;scalar&#39;, StandardScaler()), (&#39;estimator&#39;, Lasso(alpha=0.01))])</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="88" data-colab="{&quot;height&quot;:112,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="lrdVFUg0Sg0E" data-outputId="e67512ab-9a37-4ec0-811b-04134bb45183">
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>exp_name <span class="op">=</span> <span class="ss">f&quot;Linear Regression(best regularization and alpha)&quot;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>expLog.loc[<span class="dv">1</span>,:<span class="dv">4</span>] <span class="op">=</span> [<span class="ss">f&quot;</span><span class="sc">{</span>exp_name<span class="sc">}</span><span class="ss">&quot;</span>] <span class="op">+</span><span class="bu">list</span>(np.<span class="bu">round</span>([<span class="dv">0</span>, </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>],<span class="dv">3</span>))</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>expLog.loc[<span class="dv">1</span>,<span class="dv">4</span>:] <span class="op">=</span> <span class="bu">list</span>(np.<span class="bu">round</span>([mean_squared_error(y_train, pipe.predict(X_train)), </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>          mean_squared_error(y_valid, pipe.predict(X_valid)), </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>          mean_squared_error(y_test, pipe.predict(X_test))],<span class="dv">3</span>))</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>expLog</span></code></pre></div>
<div class="output execute_result" data-execution_count="88">

  <div id="df-e986fdd9-dfc4-4bf1-aca9-0f68a9a14d84">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>exp_name</th>
      <th>Train Acc</th>
      <th>Valid Acc</th>
      <th>Test  Acc</th>
      <th>Train MSE</th>
      <th>Valid MSE</th>
      <th>Test  MSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Baseline: Linear Model</td>
      <td>0.565</td>
      <td>0.557</td>
      <td>0.615</td>
      <td>0.007</td>
      <td>0.015</td>
      <td>0.015</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Linear Regression(best regularization and alpha)</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.01</td>
      <td>0.011</td>
      <td>0.009</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-e986fdd9-dfc4-4bf1-aca9-0f68a9a14d84')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-e986fdd9-dfc4-4bf1-aca9-0f68a9a14d84 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-e986fdd9-dfc4-4bf1-aca9-0f68a9a14d84');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>

</div>
</div>
<div class="cell markdown" id="0rRcR2FMSg0E">
<h3 id="modelling-pipelines">Modelling Pipelines</h3>
<h3 id="baseline">Baseline</h3>
</div>
<div class="cell code" data-execution_count="89" id="6yLm2Q7lSg0F">
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Below code is refered from HW13, Hw7,Hw2</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, GridSearchCV, PredefinedSplit</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.load(<span class="st">&#39;data/img.npy&#39;</span>, allow_pickle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>y_label <span class="op">=</span> np.load(<span class="st">&#39;data/y_label.npy&#39;</span>, allow_pickle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>y_bbox <span class="op">=</span> np.load(<span class="st">&#39;data/y_bbox.npy&#39;</span>, allow_pickle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>idx_to_label <span class="op">=</span> {<span class="dv">1</span>:<span class="st">&#39;dog&#39;</span>, <span class="dv">0</span>:<span class="st">&#39;cat&#39;</span>}</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>X_train_class, X_test_class, y_train_label, y_test_label <span class="op">=</span> train_test_split(X, y_label, stratify<span class="op">=</span>y_label, shuffle<span class="op">=</span><span class="va">True</span>, test_size<span class="op">=</span><span class="fl">0.50</span>, random_state<span class="op">=</span><span class="dv">27</span>)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.astype(np.float32) <span class="op">/</span> <span class="fl">255.</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>y_label<span class="op">=</span>y_label.astype(<span class="bu">int</span>)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>X_train_class, X_test_class, y_train_label, y_test_label <span class="op">=</span> train_test_split(X, y_label, stratify<span class="op">=</span>y_label, shuffle<span class="op">=</span><span class="va">True</span>, test_size<span class="op">=</span><span class="fl">0.20</span>, random_state<span class="op">=</span><span class="dv">27</span>)</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>X_train_full <span class="op">=</span> X_train_class</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>y_train_full <span class="op">=</span> y_train_label</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>X_test_full <span class="op">=</span> X_test_class</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>y_test_full <span class="op">=</span> y_test_label</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>X_train, _, y_train, _ <span class="op">=</span> train_test_split(X_train_class, y_train_label, stratify<span class="op">=</span>y_train_label, train_size<span class="op">=</span><span class="fl">0.1</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>X_test, _, y_test, _ <span class="op">=</span> train_test_split(X_test_class, y_test_label, stratify<span class="op">=</span>y_test_label, train_size<span class="op">=</span><span class="fl">0.1</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="90" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="VVa1g2uYSg0F" data-outputId="b16a848f-2d1f-4a3e-d1be-df46e68d8d0d">
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use full pipeline above to build full pipeline with predictor</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>full_pipeline_with_predictor <span class="op">=</span> Pipeline([</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;linear&quot;</span>, LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>))</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>full_pipeline_with_predictor.fit(X_train, y_train)</span></code></pre></div>
<div class="output execute_result" data-execution_count="90">
<pre><code>Pipeline(steps=[(&#39;linear&#39;, LogisticRegression(random_state=42))])</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="91" id="HzUm5d8lSg0F">
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time()</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>full_pipeline_with_predictor.fit(X_train, y_train)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up cross validation scores </span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ShuffleSplit() with 30 splits, 30% test_size </span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># and a random seed of 0</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co">#==================================================#</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co">#               Your code starts here              #</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co">#==================================================#</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>cv3Splits <span class="op">=</span> ShuffleSplit(n_splits<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">0</span>, test_size<span class="op">=</span><span class="fl">0.30</span>, train_size<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>logit_scores <span class="op">=</span> cross_val_score(full_pipeline_with_predictor, X_train, y_train, cv<span class="op">=</span>cv3Splits)     </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co">#==================================================#</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="co">#               Your code ends here                #</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co">#               Please don&#39;t add code below here   #</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co">#==================================================#</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>logit_score_train <span class="op">=</span> logit_scores.mean()</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>train_time <span class="op">=</span> np.<span class="bu">round</span>(time() <span class="op">-</span> start, <span class="dv">4</span>)</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Time and score test predictions</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time()</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>logit_score_test  <span class="op">=</span> full_pipeline_with_predictor.score(X_test, y_test)</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>test_time <span class="op">=</span> np.<span class="bu">round</span>(time() <span class="op">-</span> start, <span class="dv">4</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="92" data-colab="{&quot;height&quot;:81,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="HM6c0cvUSg0G" data-outputId="06afe199-0fac-49f2-c7ad-84c6256265c4">
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">&quot;Expname&quot;</span>, <span class="st">&quot;Train accuracy&quot;</span>, <span class="st">&quot;Test Accuracy&quot;</span>])</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>results.loc[<span class="dv">0</span>] <span class="op">=</span> [<span class="st">&quot;Baseline&quot;</span>, np.<span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span>logit_score_train,<span class="dv">1</span>), np.<span class="bu">round</span>(np.<span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span>logit_score_test,<span class="dv">1</span>),<span class="dv">3</span>)]</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<div class="output execute_result" data-execution_count="92">

  <div id="df-28ab7806-1d2a-49bc-8ded-9f7aeab0b8fa">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Expname</th>
      <th>Train accuracy</th>
      <th>Test Accuracy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Baseline</td>
      <td>54.0</td>
      <td>55.2</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-28ab7806-1d2a-49bc-8ded-9f7aeab0b8fa')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-28ab7806-1d2a-49bc-8ded-9f7aeab0b8fa button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-28ab7806-1d2a-49bc-8ded-9f7aeab0b8fa');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="93" id="myCbWNDXSg0G">
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A Function to execute the grid search and record the results.</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ConductGridSearch(X_train, y_train, X_test, y_test, i<span class="op">=</span><span class="dv">0</span>, prefix<span class="op">=</span><span class="st">&#39;&#39;</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>,verbose<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a list of classifiers for our grid search experiment</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    classifiers <span class="op">=</span> [</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&#39;Logistic Regression&#39;</span>, LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>)),</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&#39;K-Nearest Neighbors&#39;</span>, KNeighborsClassifier()),</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&#39;Naive Bayes&#39;</span>, GaussianNB()),</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&#39;Support Vector&#39;</span>, SVC(random_state<span class="op">=</span><span class="dv">42</span>)),</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&#39;Stochastic GD&#39;</span>, SGDClassifier(loss<span class="op">=</span><span class="st">&#39;log&#39;</span>,</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>                                        penalty<span class="op">=</span><span class="st">&#39;l2&#39;</span>,</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>                                        early_stopping<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>                                        max_iter<span class="op">=</span><span class="dv">10000</span>, tol<span class="op">=</span><span class="fl">1e-5</span>,</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>                                        random_state<span class="op">=</span><span class="dv">42</span>)),</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Arrange grid search parameters for each classifier</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>    params_grid <span class="op">=</span> {</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Logistic Regression&#39;</span>: {</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;penalty&#39;</span>: (<span class="st">&#39;l1&#39;</span>, <span class="st">&#39;l2&#39;</span>),</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;tol&#39;</span>: (<span class="fl">0.0001</span>, <span class="fl">0.00001</span>, <span class="fl">0.0000001</span>), </span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;C&#39;</span>: (<span class="dv">10</span>, <span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>),</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;K-Nearest Neighbors&#39;</span>: {</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;n_neighbors&#39;</span>: (<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">11</span>),</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;p&#39;</span>: (<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Naive Bayes&#39;</span>: {},</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Support Vector&#39;</span> : {</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;kernel&#39;</span>: (<span class="st">&#39;rbf&#39;</span>, <span class="st">&#39;poly&#39;</span>),     </span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;degree&#39;</span>: (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;C&#39;</span>: (<span class="dv">10</span>, <span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>),</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Stochastic GD&#39;</span>: {</span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;tol&#39;</span>: (<span class="fl">0.0001</span>, <span class="fl">0.0000001</span>), </span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;alpha&#39;</span>: (<span class="fl">0.1</span>, <span class="fl">0.001</span>, <span class="fl">0.0001</span>), </span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (name, classifier) <span class="kw">in</span> classifiers:</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Print classifier and parameters</span></span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;****** START&#39;</span>,prefix, name,<span class="st">&#39;*****&#39;</span>)</span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>        parameters <span class="op">=</span> params_grid[name]</span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Parameters:&quot;</span>)</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">sorted</span>(parameters.keys()):</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span><span class="op">+</span><span class="bu">str</span>(p)<span class="op">+</span><span class="st">&quot;: &quot;</span><span class="op">+</span> <span class="bu">str</span>(parameters[p]))</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># generate the pipeline</span></span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>        full_pipeline_with_predictor <span class="op">=</span> Pipeline([</span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;predictor&quot;</span>, classifier)</span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Execute the grid search</span></span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a>        params <span class="op">=</span> {}</span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> parameters.keys():</span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a>            pipe_key <span class="op">=</span> <span class="st">&#39;predictor__&#39;</span><span class="op">+</span><span class="bu">str</span>(p)</span>
<span id="cb84-60"><a href="#cb84-60" aria-hidden="true" tabindex="-1"></a>            params[pipe_key] <span class="op">=</span> parameters[p] </span>
<span id="cb84-61"><a href="#cb84-61" aria-hidden="true" tabindex="-1"></a>        grid_search <span class="op">=</span> GridSearchCV(full_pipeline_with_predictor, params, scoring<span class="op">=</span><span class="st">&#39;accuracy&#39;</span>, cv<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a>                                   n_jobs<span class="op">=</span>n_jobs, verbose<span class="op">=</span>verbose)</span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a>        grid_search.fit(X_train, y_train)</span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Best estimator score</span></span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a>        best_train <span class="op">=</span> np.<span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span>grid_search.best_score_,<span class="dv">1</span>)</span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Best estimator fitting time</span></span>
<span id="cb84-69"><a href="#cb84-69" aria-hidden="true" tabindex="-1"></a>        start <span class="op">=</span> time()</span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a>        grid_search.best_estimator_.fit(X_train, y_train)</span>
<span id="cb84-71"><a href="#cb84-71" aria-hidden="true" tabindex="-1"></a>        train_time <span class="op">=</span> <span class="bu">round</span>(time() <span class="op">-</span> start, <span class="dv">4</span>)</span>
<span id="cb84-72"><a href="#cb84-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-73"><a href="#cb84-73" aria-hidden="true" tabindex="-1"></a><span class="co"># #         plt.barh([&#39;Age&#39;, &#39;Parch&#39;, &#39;SibSp&#39;,&#39;Fare&#39;,&#39;x0_C&#39; ,&#39;x0_Q&#39; ,&#39;x0_S&#39; ,&#39;x1_female&#39;, &#39;x1_male&#39; ,&#39;x2_1&#39; ,&#39;x2_2&#39;, &#39;x2_3&#39;], grid_search.best_estimator_.named_steps[&quot;predictor&quot;].feature_importances_)</span></span>
<span id="cb84-74"><a href="#cb84-74" aria-hidden="true" tabindex="-1"></a><span class="co"># #         plt.show()</span></span>
<span id="cb84-75"><a href="#cb84-75" aria-hidden="true" tabindex="-1"></a><span class="co">#         features = [&#39;Age&#39;, &#39;Parch&#39;, &#39;SibSp&#39;,&#39;Fare&#39;,&#39;x0_C&#39; ,&#39;x0_Q&#39; ,&#39;x0_S&#39; ,&#39;x1_female&#39;, &#39;x1_male&#39; ,&#39;x2_1&#39; ,&#39;x2_2&#39;, &#39;x2_3&#39;]</span></span>
<span id="cb84-76"><a href="#cb84-76" aria-hidden="true" tabindex="-1"></a><span class="co">#         importances = grid_search.best_estimator_.named_steps[&quot;predictor&quot;].feature_importances_</span></span>
<span id="cb84-77"><a href="#cb84-77" aria-hidden="true" tabindex="-1"></a><span class="co">#         indices = np.argsort(importances)</span></span>
<span id="cb84-78"><a href="#cb84-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-79"><a href="#cb84-79" aria-hidden="true" tabindex="-1"></a><span class="co">#         plt.title(&#39;Feature Importances&#39;)</span></span>
<span id="cb84-80"><a href="#cb84-80" aria-hidden="true" tabindex="-1"></a><span class="co">#         plt.barh(range(len(indices)), importances[indices], color=&#39;b&#39;, align=&#39;center&#39;)</span></span>
<span id="cb84-81"><a href="#cb84-81" aria-hidden="true" tabindex="-1"></a><span class="co">#         plt.yticks(range(len(indices)), [features[i] for i in indices])</span></span>
<span id="cb84-82"><a href="#cb84-82" aria-hidden="true" tabindex="-1"></a><span class="co">#         plt.xlabel(&#39;Relative Importance&#39;)</span></span>
<span id="cb84-83"><a href="#cb84-83" aria-hidden="true" tabindex="-1"></a><span class="co">#         plt.grid()</span></span>
<span id="cb84-84"><a href="#cb84-84" aria-hidden="true" tabindex="-1"></a><span class="co">#         plt.show();</span></span>
<span id="cb84-85"><a href="#cb84-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Best estimator prediction time</span></span>
<span id="cb84-86"><a href="#cb84-86" aria-hidden="true" tabindex="-1"></a>        start <span class="op">=</span> time()</span>
<span id="cb84-87"><a href="#cb84-87" aria-hidden="true" tabindex="-1"></a>        best_test_accuracy <span class="op">=</span> np.<span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span>grid_search.best_estimator_.score(X_test, y_test),<span class="dv">1</span>)</span>
<span id="cb84-88"><a href="#cb84-88" aria-hidden="true" tabindex="-1"></a>        test_time <span class="op">=</span> <span class="bu">round</span>(time() <span class="op">-</span> start, <span class="dv">4</span>)</span>
<span id="cb84-89"><a href="#cb84-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-90"><a href="#cb84-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate 30 training accuracy scores with the best estimator and 30-split CV</span></span>
<span id="cb84-91"><a href="#cb84-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># To calculate the best_train_accuracy use the pct() and mean() methods</span></span>
<span id="cb84-92"><a href="#cb84-92" aria-hidden="true" tabindex="-1"></a>        <span class="co">#==================================================#</span></span>
<span id="cb84-93"><a href="#cb84-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">#               Your code starts here              #</span></span>
<span id="cb84-94"><a href="#cb84-94" aria-hidden="true" tabindex="-1"></a>        <span class="co">#==================================================#</span></span>
<span id="cb84-95"><a href="#cb84-95" aria-hidden="true" tabindex="-1"></a>        best_train_scores <span class="op">=</span> cross_val_score(grid_search.best_estimator_, X_train, y_train, cv<span class="op">=</span>cv3Splits)</span>
<span id="cb84-96"><a href="#cb84-96" aria-hidden="true" tabindex="-1"></a>        best_train_accuracy <span class="op">=</span> np.<span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span>best_train_scores.mean(),<span class="dv">1</span>)</span>
<span id="cb84-97"><a href="#cb84-97" aria-hidden="true" tabindex="-1"></a>        <span class="co">#==================================================#</span></span>
<span id="cb84-98"><a href="#cb84-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">#               Your code ends here                #</span></span>
<span id="cb84-99"><a href="#cb84-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">#               Please don&#39;t add code below here   #</span></span>
<span id="cb84-100"><a href="#cb84-100" aria-hidden="true" tabindex="-1"></a>        <span class="co">#==================================================#    </span></span>
<span id="cb84-101"><a href="#cb84-101" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb84-102"><a href="#cb84-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Conduct t-test with baseline logit (control) and best estimator (experiment)</span></span>
<span id="cb84-103"><a href="#cb84-103" aria-hidden="true" tabindex="-1"></a>        (t_stat, p_value) <span class="op">=</span> stats.ttest_rel(logit_scores, best_train_scores)</span>
<span id="cb84-104"><a href="#cb84-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-105"><a href="#cb84-105" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Collect the best parameters found by the grid search</span></span>
<span id="cb84-106"><a href="#cb84-106" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Best Parameters:&quot;</span>)</span>
<span id="cb84-107"><a href="#cb84-107" aria-hidden="true" tabindex="-1"></a>        best_parameters <span class="op">=</span> grid_search.best_estimator_.get_params()</span>
<span id="cb84-108"><a href="#cb84-108" aria-hidden="true" tabindex="-1"></a>        param_dump <span class="op">=</span> []</span>
<span id="cb84-109"><a href="#cb84-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> param_name <span class="kw">in</span> <span class="bu">sorted</span>(params.keys()):</span>
<span id="cb84-110"><a href="#cb84-110" aria-hidden="true" tabindex="-1"></a>            param_dump.append((param_name, best_parameters[param_name]))</span>
<span id="cb84-111"><a href="#cb84-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span><span class="op">+</span><span class="bu">str</span>(param_name)<span class="op">+</span><span class="st">&quot;: &quot;</span> <span class="op">+</span> <span class="bu">str</span>(best_parameters[param_name]))</span>
<span id="cb84-112"><a href="#cb84-112" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;****** FINISH&quot;</span>,prefix,name,<span class="st">&quot; *****&quot;</span>)</span>
<span id="cb84-113"><a href="#cb84-113" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb84-114"><a href="#cb84-114" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-115"><a href="#cb84-115" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Record the results</span></span>
<span id="cb84-116"><a href="#cb84-116" aria-hidden="true" tabindex="-1"></a>        results.loc[i] <span class="op">=</span> [prefix<span class="op">+</span>name, best_train_accuracy, best_test_accuracy]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="94" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="jDlX7wdBSg0H" data-outputId="fc6f2662-b338-4c5f-a03a-02de90559e24">
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>ConductGridSearch(X_train, y_train, X_test, y_test, <span class="dv">0</span>, <span class="st">&quot;Best Model:&quot;</span>,  n_jobs<span class="op">=-</span><span class="dv">1</span>,verbose<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>****** START Best Model: Logistic Regression *****
Parameters:
	C: (10, 1, 0.1, 0.01)
	penalty: (&#39;l1&#39;, &#39;l2&#39;)
	tol: (0.0001, 1e-05, 1e-07)
Fitting 5 folds for each of 24 candidates, totalling 120 fits
Best Parameters:
	predictor__C: 0.01
	predictor__penalty: l2
	predictor__tol: 0.0001
****** FINISH Best Model: Logistic Regression  *****

****** START Best Model: K-Nearest Neighbors *****
Parameters:
	n_neighbors: (3, 5, 7, 8, 11)
	p: (1, 2)
Fitting 5 folds for each of 10 candidates, totalling 50 fits
Best Parameters:
	predictor__n_neighbors: 11
	predictor__p: 2
****** FINISH Best Model: K-Nearest Neighbors  *****

****** START Best Model: Naive Bayes *****
Parameters:
Fitting 5 folds for each of 1 candidates, totalling 5 fits
Best Parameters:
****** FINISH Best Model: Naive Bayes  *****

****** START Best Model: Support Vector *****
Parameters:
	C: (10, 1, 0.1, 0.01)
	degree: (1, 2, 3, 4, 5)
	kernel: (&#39;rbf&#39;, &#39;poly&#39;)
Fitting 5 folds for each of 40 candidates, totalling 200 fits
Best Parameters:
	predictor__C: 1
	predictor__degree: 1
	predictor__kernel: poly
****** FINISH Best Model: Support Vector  *****

****** START Best Model: Stochastic GD *****
Parameters:
	alpha: (0.1, 0.001, 0.0001)
	tol: (0.0001, 1e-07)
Fitting 5 folds for each of 6 candidates, totalling 30 fits
Best Parameters:
	predictor__alpha: 0.1
	predictor__tol: 0.0001
****** FINISH Best Model: Stochastic GD  *****

</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="95" data-colab="{&quot;height&quot;:237,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="Ja4YNMsJSg0H" data-outputId="ed7ee98b-c58c-4e73-8e14-b5bfde012aac">
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<div class="output execute_result" data-execution_count="95">

  <div id="df-ee164a99-56e7-4bfd-a1e1-78efe0612029">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Expname</th>
      <th>Train accuracy</th>
      <th>Test Accuracy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Baseline</td>
      <td>54.0</td>
      <td>55.2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Best Model:Logistic Regression</td>
      <td>56.9</td>
      <td>53.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Best Model:K-Nearest Neighbors</td>
      <td>53.0</td>
      <td>56.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Best Model:Naive Bayes</td>
      <td>54.0</td>
      <td>55.2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Best Model:Support Vector</td>
      <td>56.1</td>
      <td>52.9</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Best Model:Stochastic GD</td>
      <td>52.9</td>
      <td>57.9</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-ee164a99-56e7-4bfd-a1e1-78efe0612029')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-ee164a99-56e7-4bfd-a1e1-78efe0612029 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-ee164a99-56e7-4bfd-a1e1-78efe0612029');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>

</div>
</div>
<section id="homegrown-implementation" class="cell markdown" id="wm9n1D-0T4ze">
<h1>Homegrown implementation</h1>
<p>Implement a Homegrown Logistic Regression model. Extend the loss function from CXE to CXE + MSE, i.e., make it a complex multitask loss function the resulting model predicts the class and bounding box coordinates at the same time.</p>
</section>
<section id="results--discussion" class="cell markdown" id="wAFAXE6wKqIy">
<h1>Results / Discussion</h1>
</section>
<div class="cell markdown" id="rV15sPwGKqIy">
<p>Cats and Dogs Classification is a popular ML problem, which can be solved using various techniques. We performed algorithms like logistic regression, KNN, Naive Baye’s, Support Vector, Stochastic Gradient Descent, to find out how well these algorithms can predict class for the cat and dog image set.</p>
<ul>
<li>Among all the models Gradient Descent proved to be better, with accuracy of 57.9 and the runner up is KNN.</li>
<li>We have also implemented Baseline linear regression along with Baseline LR with Lasso and Ridge(with alpha and best parameters). Lasso and Ridge metrics performed better.</li>
</ul>
</div>
<section id="challenges-" class="cell markdown" id="lrBgqFcZSg0I">
<h1>Challenges :</h1>
<p>The main challenges was to work with a huge dataset. Hence we decreased image size from 128x128 to 32x32.</p>
</section>
<section id="conclusion" class="cell markdown" id="NSMGGEQpKqIy">
<h1>Conclusion</h1>
</section>
<div class="cell markdown" id="9sL2DDOzKqIy">
<p>In phase 1, we have focused on the SKLearn Baseline models for logistic regression, SGDClassifier to classify the images into cats and dogs and Linear regression for making the bounding boxes around the cats and dogs inside the image. Well, Test Accuracy alone can’t tell how good an algorithm predicts the classes in general on various data set. We hope to experiment more by implementing homegrown logistic regression model and CNN in the next phase.</p>
</div>
<div class="cell code" id="HIYO8m5QUMAe">
<div class="sourceCode" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
